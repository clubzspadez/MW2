class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(t){fetch(DBHelper.DATABASE_URL).then(e=>{e&&e.json().then(e=>{const r=e;idb.open("restv1Db",1,t=>{switch(t.oldVersion){case 0:t.createObjectStore("restaurants",{keyPath:"id"})}}).then(t=>{const e=t.transaction("restaurant","readwrite").objectStore("restaurants");return r.forEach(t=>{e.put(t)}),e.getAll()}),t(null,r)})}).catch(e=>{t(e,null),console.log(`Fetch Error: ${e}`)})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.find((t,e)=>t.id===e+1);t?e(null,t):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`img/${t.id}.jpg`}static altForRestaurant(t){return`${t.alt}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines(),registerWorker()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,s=t.selectedIndex,n=e[r].value,o=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),r=document.createElement("img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.alt=DBHelper.altForRestaurant(e),t.append(r);const s=document.createElement("h1");s.innerHTML=e.name,t.append(s);const n=document.createElement("p");n.innerHTML=e.neighborhood,t.append(n);const o=document.createElement("p");o.innerHTML=e.address,t.append(o);const a=document.createElement("a");return a.innerHTML="View Details",a.href=DBHelper.urlForRestaurant(e),t.append(a),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),registerWorker=(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Registration successful, scope is:",e.scope)}).catch(e=>{console.log("Service worker registration failed, error: ",e)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwianNvbiIsInJlc3RhdXJhbnRzIiwiZGJQcm9taXNlIiwib3BlbiIsIm9sZFZlcnNpb24iLCJ1cGdyYWRlREIiLCJrZXlQYXRoIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJkYiIsInN0b3JlIiwidHgiLCJvYmplY3RTdG9yZSIsInJlc3RhdXJhbnQiLCJwdXQiLCJnZXRBbGwiLCJjb25zb2xlIiwiZXJyIiwibG9nIiwiaWQiLCJlcnJvciIsImZpbmQiLCJpbmRleCIsImN1aXNpbmUiLCJmZXRjaFJlc3RhdXJhbnRzIiwicmVzdWx0cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsImluZGV4T2YiLCJtYXJrZXIiLCJnb29nbGUiLCJhbHQiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImZldGNoQ3Vpc2luZXMiLCJyZWdpc3RlcldvcmtlciIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImZvckVhY2giLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInJlc2V0UmVzdGF1cmFudHMiLCJ1bCIsIm0iLCJzZXRNYXAiLCJhZGRNYXJrZXJzVG9NYXAiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImltYWdlIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiY2xhc3NOYW1lIiwibGkiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJsb2NhdGlvbiIsInB1c2giLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWdpc3RyYXRpb24iLCJzY29wZSIsImNhdGNoIl0sIm1hcHBpbmdzIjoiQUFJQSxNQUFNQSxTQUtKQywwQkFFRSxNQUFRLG9DQU1WQyx3QkFBd0JDLEdBQ3RCQyxNQUFNSixTQUFTQyxjQUVYSSxLQUFLQyxJQUNIQSxHQUdFQSxFQUFBQyxPQUFNQyxLQUFBQSxJQUNOLE1BQU1DLEVBQWdCQyxFQUNGQyxJQUFBQSxLQUFBQSxXQUFsQixFQUFBQyxJQUNFLE9BQUFBLEVBQUFELFlBQ0VDLEtBQUFBLEVBQ0VDLEVBQVNDLGtCQUFBLGNBQUEsQ0FEWEQsUUFBQSxVQU1KUixLQUFBVSxJQUVBLE1BQ0FQLEVBRE1RLEVBQVFDLFlBQUEsYUFBQSxhQUNkQyxZQUFvQkMsZUFKdEIsT0FLSUgsRUFBVUcsUUFBVkEsSUFERkgsRUFBQUksSUFBQUQsS0FKRkgsRUFBQUssV0FWRmxCLEVBQUEsS0FBQUssT0F5QkZjLE1BQUFBLElBOUJKbkIsRUFBQW9CLEVBQUEsTUFnQ0RELFFBQUFFLG9CQUFBRCxPQU9DdkIsMkJBQUF5QixF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QyxNQUNMRCxrQkFBWXdGLFdBQ2JBLFVBUEhDLGNBUURDLFNBQUEsVUFWSDNHLEtBQUE0RyxJQUtRM0YsUUFBUUUsSUFBSSxxQ0FBc0N5RixFQUFhQyxTQUVoRUMsTUFBTTVGLElBQ0xELFFBQVFFLElBQUksOENBQStDRCIsImZpbGUiOiJpbmRleC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5cclxuY2xhc3MgREJIZWxwZXIge1xyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXMpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzLmpzb24oKS50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGRhdGE7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiUHJvbWlzZSA9IGlkYi5vcGVuKFwicmVzdHYxRGJcIiwgMSwgdXBncmFkZURCID0+IHtcclxuICAgICAgICAgICAgICBzd2l0Y2ggKHVwZ3JhZGVEQi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgIHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImlkXCJcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgICAgIC8vIG9wZW4gdHJhbnNhY3Rpb25cclxuICAgICAgICAgICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicmVzdGF1cmFudFwiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwicmVzdGF1cmFudHNcIik7XHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEZldGNoIEVycm9yOiAke2Vycn1gKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChcclxuICAgICAgICAgIChvYmosIGluZGV4KSA9PiBvYmpbXCJpZFwiXSA9PT0gaW5kZXggKyAxXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKFwiUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdFwiLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxyXG4gICAgY3Vpc2luZSxcclxuICAgIG5laWdoYm9yaG9vZCxcclxuICAgIGNhbGxiYWNrXHJcbiAgKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSBcImFsbFwiKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gXCJhbGxcIikge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoXHJcbiAgICAgICAgICAodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXHJcbiAgICAgICAgKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYGltZy8ke3Jlc3RhdXJhbnQuaWR9LmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGFsdCBkZXNjcmlwdGlvbi5cclxuICAgKi9cclxuICBzdGF0aWMgYWx0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYCR7cmVzdGF1cmFudC5hbHR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnRzLCBuZWlnaGJvcmhvb2RzLCBjdWlzaW5lcztcclxudmFyIG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGV2ZW50ID0+IHtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbiAgcmVnaXN0ZXJXb3JrZXIoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5laWdoYm9yaG9vZHMtc2VsZWN0XCIpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN1aXNpbmVzLXNlbGVjdFwiKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYXBcIiksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdWlzaW5lcy1zZWxlY3RcIik7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmVpZ2hib3Job29kcy1zZWxlY3RcIik7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXHJcbiAgICBjdWlzaW5lLFxyXG4gICAgbmVpZ2hib3Job29kLFxyXG4gICAgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5yZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHMgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnRzLWxpc3RcIik7XHJcbiAgdWwuaW5uZXJIVE1MID0gXCJcIjtcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudHMtbGlzdFwiKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSByZXN0YXVyYW50ID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudC1pbWdcIjtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuYWx0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBsaS5hcHBlbmQoaW1hZ2UpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSBcIlZpZXcgRGV0YWlsc1wiO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKG1vcmUpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufTtcclxuXHJcbnJlZ2lzdGVyV29ya2VyID0gKCkgPT4ge1xyXG4gIGlmIChcInNlcnZpY2VXb3JrZXJcIiBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyXHJcbiAgICAgIC5yZWdpc3RlcihcIi9zdy5qc1wiKVxyXG4gICAgICAudGhlbihyZWdpc3RyYXRpb24gPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUmVnaXN0cmF0aW9uIHN1Y2Nlc3NmdWwsIHNjb3BlIGlzOlwiLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiBmYWlsZWQsIGVycm9yOiBcIiwgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59O1xyXG4iXX0=
