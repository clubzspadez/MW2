var dbPromise;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDb(){return idb.open("restaurant-rev",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static addRest(){dbPromise=DBHelper.openDb(),console.log(dbPromise),fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(t=>{console.log(dbPromise),dbPromise.then(e=>{let r=e.transaction("restaurants","readwrite").objectStore("restaurants");t.forEach(t=>{r.put(t)})}),callback(null,t)}).catch(t=>{dbPromise.then(t=>{return t.transaction("restaurants").objectStore("restaurants").getAll()})})}static getID(t){return dbPromise.then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").get(parseInt(t))}).then(t=>t).catch(function(t){console.log(`ERROR: ${t}`)})}static getAll(){dbPromise.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(t=>console.log(t))}static fetchRestaurants(t){DBHelper.addRest(t),restaurants||fetch(DBHelper.DATABASE_URL).then(e=>{e&&e.json().then(e=>{t(null,e)})}).catch(e=>{t(e,null),console.log(`Fetch Error: ${e}`)})}static fetchRestaurantById(t,e){DBHelper.getID(t).then(t=>{t?e(null,t):DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.find((t,e)=>t.id===e+1);t?e(null,t):e("Restaurant does not exist",null)}})}).catch(t=>{e(t,null)})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`img/${t.id}.jpg`}static altForRestaurant(t){return`${t.alt}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines(),registerWorker()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,s=t.selectedIndex,n=e[r].value,o=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),r=document.createElement("img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.alt=DBHelper.altForRestaurant(e),t.append(r);const s=document.createElement("h1");s.innerHTML=e.name,t.append(s);const n=document.createElement("p");n.innerHTML=e.neighborhood,t.append(n);const o=document.createElement("p");o.innerHTML=e.address,t.append(o);const a=document.createElement("a");return a.innerHTML="View Details",a.href=DBHelper.urlForRestaurant(e),t.append(a),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),registerWorker=(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Registration successful, scope is:",e.scope)}).catch(e=>{console.log("Service worker registration failed, error: ",e)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJkYlByb21pc2UiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJvcGVuRGIiLCJjb25zb2xlIiwibG9nIiwiZmV0Y2giLCJ0eCIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsInJlc3RhdXJhbnRzIiwiZm9yRWFjaCIsInJlc3RhdXJhbnQiLCJwdXQiLCJ0aGVuIiwiZGIiLCJjYXRjaCIsImdldEFsbCIsInJlc3RhdXJhbnRPYmplY3QiLCJnZXQiLCJwYXJzZUludCIsImlkIiwiZSIsImZldGNoUmVzdGF1cmFudHMiLCJjYWxsYmFjayIsImFkZFJlc3QiLCJyZXMiLCJqc29uIiwiZGF0YSIsImVyciIsImdldElEIiwiZXJyb3IiLCJmaW5kIiwib2JqIiwiaW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJ2IiwiaSIsImluZGV4T2YiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJhbHRGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwibWFwcyIsImFsdCIsImdvb2dsZSIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsIkFuaW1hdGlvbiIsIkRST1AiLCJtYXJrZXJzIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaEN1aXNpbmVzIiwicmVnaXN0ZXJXb3JrZXIiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsInJlc2V0UmVzdGF1cmFudHMiLCJ1bCIsIm0iLCJzZXRNYXAiLCJhZGRNYXJrZXJzVG9NYXAiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImltYWdlIiwic3JjIiwiY2xhc3NOYW1lIiwibGkiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJsb2NhdGlvbiIsInB1c2giLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJyZWdpc3RyYXRpb24iLCJzY29wZSJdLCJtYXBwaW5ncyI6IkFBR0EsSUFBSUEsVUFDSixNQUFNQyxTQUtKQywwQkFFRSxNQUFRLG9DQUdWQyxnQkFDRSxPQUFPQyxJQUFJQyxLQUFLLGlCQUFrQixFQUFHQyxJQUNuQ0EsRUFBVUMsa0JBQWtCLGNBQWUsQ0FDekNDLFFBQVMsU0FNZkwsaUJBQ0VILFVBQVlDLFNBQVNRLFNBQ3JCQyxRQUFRQyxJQUFJWCxXQUNaWSxNQUFNWCxTQUFTQyxjQUdYUSxLQUFBQSxHQUFZVixFQUFBQSxRQUNaQSxLQUFBQSxJQUNFVSxRQUFJRyxJQUFRQyxXQUNaZCxVQUFJZSxLQUFXQyxJQUNmQyxJQUNFRixFQURGRSxFQUFZQyxZQUFR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RSxVQUFZLGlCQUtsQkYsRUFBTTNDLElBQUFBLFNBQU9NLHNCQUFidkQsR0FDQWlELEVBQUtpQixJQUFBQSxTQUFZbEUsaUJBQWpCQSxHQUNBK0YsRUFBRzNCLE9BQU9uQixHQUVWLE1BQU1wQixFQUFBQSxTQUFlMEIsY0FBU1UsTUFDOUJwQyxFQUFBQSxVQUFhcUMsRUFBWWxFLEtBQ3pCK0YsRUFBRzNCLE9BQU92QyxHQUVWLE1BQU1tRSxFQUFVekMsU0FBU1UsY0FBekIsS0FDQStCLEVBQVE5QixVQUFZbEUsRUFBV2dHLGFBQy9CRCxFQUFHM0IsT0FBTzRCLEdBRVYsTUFBTUMsRUFBTzFDLFNBQVNVLGNBQVQsS0FDYmdDLEVBQUsvQixVQUFZbEUsRUFBakJnRyxRQUNBQyxFQUFBQSxPQUFBRCxHQUZBLE1BQU1DLEVBQU8xQyxTQUFTVSxjQUFjLEtBS3BDLE9BQUFnQyxFQUFBL0IsVUFBQSxlQTFCRitCLEVBQUFDLEtBQUFwSCxTQUFBcUUsaUJBQUFuRCxHQXdCRStGLEVBQUczQixPQUFPNkIsR0FFSEYsSUFVTG5ELGdCQUFZYSxFQUFBQSxFQUFaRyxLQUE4QnVDLGVBQzVCN0IsRUFBTzhCLFFBQVNGLElBRWxCdEMsTUFBS04sRUFBUStDLFNBQWJDLHVCQUFBdEcsRUFBQTRELEtBQUE1QixLQU5GWSxPQUFBRixLQUFBZSxNQUFBOEMsWUFBQUosRUFBQSxRQUFBLEtBREY3QixPQUFBOEIsU0FBQUYsS0FBQUMsRUFBQWpELE1BV0FTLEtBQUFBLFFBQWlCMEMsS0FBQUYsT0FNVnhDLGVBQ00xQyxNQUNMMUIsa0JBQVlpSCxXQUNiQSxVQVBIQyxjQVFEQyxTQUFBLFVBVkh4RyxLQUFBeUcsSUFLUXBILFFBQVFDLElBQUkscUNBQXNDbUgsRUFBYUMsU0FFaEV4RyxNQUFNYSxJQUNMMUIsUUFBUUMsSUFBSSw4Q0FBK0N5QiIsImZpbGUiOiJpbmRleC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG52YXIgZGJQcm9taXNlO1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3OyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgb3BlbkRiKCkge1xyXG4gICAgcmV0dXJuIGlkYi5vcGVuKFwicmVzdGF1cmFudC1yZXZcIiwgMSwgdXBncmFkZURCID0+IHtcclxuICAgICAgdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKFwicmVzdGF1cmFudHNcIiwge1xyXG4gICAgICAgIGtleVBhdGg6IFwiaWRcIlxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gYWRkIHJlc3RhdXJhbnRzIHRvIG9wZW5lZCBJREJcclxuICBzdGF0aWMgYWRkUmVzdCgpIHtcclxuICAgIGRiUHJvbWlzZSA9IERCSGVscGVyLm9wZW5EYigpO1xyXG4gICAgY29uc29sZS5sb2coZGJQcm9taXNlKTtcclxuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTClcclxuICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhkYlByb21pc2UpO1xyXG4gICAgICAgIGRiUHJvbWlzZS50aGVuKGRiID0+IHtcclxuICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwicmVzdGF1cmFudHNcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKTtcclxuICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBnZXQgc3BlY2lmaWMgcmVzdGF1cmFudFxyXG4gIHN0YXRpYyBnZXRJRChpZCkge1xyXG4gICAgcmV0dXJuIGRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIsIFwicmVhZG9ubHlcIik7XHJcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgIHJldHVybiBzdG9yZS5nZXQocGFyc2VJbnQoaWQpKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudE9iamVjdCA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRPYmplY3Q7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEVSUk9SOiAke2V9YCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gZ2V0IHZhbHVlcyBmb3Igc3RvcmVcclxuICBzdGF0aWMgZ2V0QWxsKCkge1xyXG4gICAgZGJQcm9taXNlXHJcbiAgICAgIC50aGVuKGRiID0+IHtcclxuICAgICAgICByZXR1cm4gZGJcclxuICAgICAgICAgIC50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIpXHJcbiAgICAgICAgICAub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKVxyXG4gICAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiBjb25zb2xlLmxvZyhyZXN0YXVyYW50cykpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBjYWxsYmFjayB3aWxsIGdldCBpbnN0YW5jZSBvZiByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuYWRkUmVzdChjYWxsYmFjayk7XHJcbiAgICAvLyBpZiBubyByZXN0YXVyYW50cyBmZXRjaCBmcm9tIHNlcnZlclxyXG4gICAgaWYgKCFyZXN0YXVyYW50cykge1xyXG4gICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICAgIGlmICghcmVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKCkudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaCBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgLy8gcmV0dXJucyBpbnN0YW5jZSBvZiBhIHJlc3RhdXJhbnQgb2JqZWN0IGZyb20gdGhlIGFycmF5XHJcbiAgICBsZXQgcmVzdGF1cmFudCA9IERCSGVscGVyLmdldElEKGlkKTtcclxuICAgIHJlc3RhdXJhbnRcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgLy8gaWYgd2UgaGF2ZSB2YWxpZCByZXNwb25zZSBwYXNzIHRvIGNhbGxiYWNrXHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBmZXRjaCBmcm9tIG5vdCB3b3JrIGlmIHdlIGRvbnQgaGF2ZSByZXNwb25zZVxyXG4gICAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChcclxuICAgICAgICAgICAgICAgIChvYmosIGluZGV4KSA9PiBvYmpbXCJpZFwiXSA9PT0gaW5kZXggKyAxXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICBpZiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKFwiUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdFwiLCBudWxsKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXHJcbiAgICBjdWlzaW5lLFxyXG4gICAgbmVpZ2hib3Job29kLFxyXG4gICAgY2FsbGJhY2tcclxuICApIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9IFwiYWxsXCIpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSBcImFsbFwiKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcclxuICAgICAgICAgICh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2RcclxuICAgICAgICApO1xyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcihcclxuICAgICAgICAgICh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcihcclxuICAgICAgICAgICh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgYWx0IGRlc2NyaXB0aW9uLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBhbHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgJHtyZXN0YXVyYW50LmFsdH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxufVxyXG4iLCJsZXQgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzO1xyXG52YXIgbWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZXZlbnQgPT4ge1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxuICByZWdpc3RlcldvcmtlcigpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmVpZ2hib3Job29kcy1zZWxlY3RcIik7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgY3Vpc2luZXMpID0+IHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xyXG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3Vpc2luZXMtc2VsZWN0XCIpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcFwiKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN1aXNpbmVzLXNlbGVjdFwiKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuZWlnaGJvcmhvb2RzLXNlbGVjdFwiKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSByZXN0YXVyYW50cyA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudHMtbGlzdFwiKTtcclxuICB1bC5pbm5lckhUTUwgPSBcIlwiO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50cy1saXN0XCIpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IHJlc3RhdXJhbnQgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gXCJyZXN0YXVyYW50LWltZ1wiO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5hbHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XHJcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICBtb3JlLmlubmVySFRNTCA9IFwiVmlldyBEZXRhaWxzXCI7XHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBsaS5hcHBlbmQobW9yZSk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxyXG4gKi9cclxuYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcclxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCBcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xyXG4gICAgfSk7XHJcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxucmVnaXN0ZXJXb3JrZXIgPSAoKSA9PiB7XHJcbiAgaWYgKFwic2VydmljZVdvcmtlclwiIGluIG5hdmlnYXRvcikge1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXJcclxuICAgICAgLnJlZ2lzdGVyKFwiL3N3LmpzXCIpXHJcbiAgICAgIC50aGVuKHJlZ2lzdHJhdGlvbiA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJSZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bCwgc2NvcGUgaXM6XCIsIHJlZ2lzdHJhdGlvbi5zY29wZSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIGZhaWxlZCwgZXJyb3I6IFwiLCBlcnIpO1xyXG4gICAgICB9KTtcclxuICB9XHJcbn07XHJcbiJdfQ==
