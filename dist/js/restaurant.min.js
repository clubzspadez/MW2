var dbPromise;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDb(){return idb.open("restv1Db",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static addRest(){dbPromise=DBHelper.openDb(),fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(t=>{dbPromise.then(e=>{let r=e.transaction("restaurant","readwrite").objectStore("restaurants");t.forEach(t=>{r.put(t)})}),callback(null,t)}).catch(t=>{dbPromise.then(t=>{return t.transaction("restaurants").objectStore("restaurants").getAll()})})}static getID(t){return dbPromise.then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").get(parseInt(t))}).then(t=>t).catch(function(t){console.log(`ERROR: ${t}`)})}static getAll(){dbPromise.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(t=>console.log(t))}static fetchRestaurants(t){DBHelper.addRest(t),restaurants||fetch(DBHelper.DATABASE_URL).then(e=>{e&&e.json().then(e=>{t(null,e)})}).catch(e=>{t(e,null),console.log(`Fetch Error: ${e}`)})}static fetchRestaurantById(t,e){DBHelper.getID(t).then(t=>{t?e(null,t):DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.find((t,e)=>t.id===e+1);t?e(null,t):e("Restaurant does not exist",null)}})})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`img/${t.id}.jpg`}static altForRestaurant(t){return`${t.alt}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurant;var map;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const l=document.createElement("td");l.innerHTML=e[n],r.appendChild(l),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=e.date,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-label","current page"),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbImRiUHJvbWlzZSIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEQiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsIm9wZW5EYiIsImZldGNoIiwidGhlbiIsImRiIiwidHgiLCJzdG9yZSIsIm9iamVjdFN0b3JlIiwicmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNhdGNoIiwiZ2V0QWxsIiwidHJhbnNhY3Rpb24iLCJyZXN0YXVyYW50T2JqZWN0IiwiY29uc29sZSIsImdldCIsInBhcnNlSW50IiwiaWQiLCJlIiwiZmV0Y2hSZXN0YXVyYW50cyIsImNhbGxiYWNrIiwiYWRkUmVzdCIsInJlcyIsImpzb24iLCJkYXRhIiwiZXJyIiwibG9nIiwiZ2V0SUQiLCJlcnJvciIsImZpbmQiLCJvYmoiLCJpbmRleCIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsImZldGNoTmVpZ2hib3Job29kcyIsIm5laWdoYm9yaG9vZHMiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwidiIsIm1hcCIsInVuaXF1ZUN1aXNpbmVzIiwiY3Vpc2luZXMiLCJpIiwiaW5kZXhPZiIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFsdEZvclJlc3RhdXJhbnQiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYWx0IiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIndpbmRvdyIsImluaXRNYXAiLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwic2VsZiIsIk1hcCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ6b29tIiwiY2VudGVyIiwic2Nyb2xsd2hlZWwiLCJmaWxsQnJlYWRjcnVtYiIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwiY3JlYXRlRWxlbWVudCIsImtleSIsImRheSIsImFwcGVuZENoaWxkIiwicm93IiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJ1bCIsImNyZWF0ZVJldmlld0hUTUwiLCJyZXZpZXciLCJsaSIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsInNldEF0dHJpYnV0ZSIsImJyZWFkY3J1bWIiLCJyZWdleCIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiQUFHQSxJQUFJQSxVQUNKLE1BQU1DLFNBS0pDLDBCQUVFLE1BQVEsb0NBR1ZDLGdCQUNFLE9BQU9DLElBQUlDLEtBQUssV0FBWSxFQUFHQyxJQUM3QkEsRUFBVUMsa0JBQWtCLGNBQWUsQ0FDekNDLFFBQVMsU0FNZkwsaUJBQ0VILFVBQVlDLFNBQVNRLFNBQ3JCQyxNQUFNVCxTQUFTQyxjQUdYRixLQUFBQSxHQUFVVyxFQUFLQyxRQUNiRCxLQUFJRSxJQUNKYixVQUFJYyxLQUFXQyxJQUNmQyxJQUNFRixFQURGRSxFQUFZQyxZQUFRQyxhQUFjLGFBQ3RCQSxZQUFWLGVBREZGLEVBQUFDLFFBQUFDLElBSEZKLEVBQUFLLElBQUFELE9BVUFsQixTQUFVVyxLQUFLQyxLQUViUSxNQUFJTixJQUNKZCxVQUFPYyxLQUFNTyxJQUdwQixPQU5LVCxFQUFBVSxZQUFBLGVBYkpQLFlBQUEs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VyxTQUFmZCxjQUFBLEtBREFjLEVBQU94QixxQkFBdUJxQixFQUFPRyxTQUdyQ0YsRUFBQVQsWUFBTVksR0FFTkgsTUFBR1QsRUFBWVksU0FBZmYsY0FBQSxLQUVBLE9BSEFlLEVBQVN6QixVQUFZcUIsRUFBT0ksU0FHNUJILEVBQUFULFlBQUFZLEdBQU9ILElBUVAzQixlQUFXTCxFQUFBQSxFQUFTb0IsS0FBYy9FLGNBQ2xDMkYsTUFBR3RCLEVBQVlyRSxTQUFXa0QsZUFBMUIsY0FDRzZDLEVBQUFBLFNBQWFoQixjQUFjLE1BQzlCaUIsRUFBQUEsVUFBV2QsRUFBWGhDLEtBTEZ5QyxFQUFBSSxhQUFBLGFBQUEsZ0JBS0VDLEVBQVdkLFlBQVlTLEtBUXZCekMsbUJBQU8sRUFBYUEsRUFBQVQsS0FDcEJBLElBQU13RCxFQUFRM0MsT0FBSTRDLFNBQWNoRCxNQUFoQ0EsRUFDRXpCLEVBQUFBLFFBQVV3RSxVQURaLFFBRUEsTUFDQXhFLEVBRGMsSUFBQXlFLGNBQUFoRCxzQkFDR2lELEtBQUExRCxHQUNqQixPQUFBaEIsRUFQRkEsRUFBQSxHQU9TMkUsbUJBQW1CM0UsRUFBUSxHQUFHNEUsUUFBUSxNQUFPLE1BUHRELEdBT1NEIiwiZmlsZSI6InJlc3RhdXJhbnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxudmFyIGRiUHJvbWlzZTtcclxuY2xhc3MgREJIZWxwZXIge1xyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYigpIHtcclxuICAgIHJldHVybiBpZGIub3BlbihcInJlc3R2MURiXCIsIDEsIHVwZ3JhZGVEQiA9PiB7XHJcbiAgICAgIHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIsIHtcclxuICAgICAgICBrZXlQYXRoOiBcImlkXCJcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGFkZCByZXN0YXVyYW50cyB0byBvcGVuZWQgSURCXHJcbiAgc3RhdGljIGFkZFJlc3QoKSB7XHJcbiAgICBkYlByb21pc2UgPSBEQkhlbHBlci5vcGVuRGIoKTtcclxuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTClcclxuICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKTtcclxuICAgICAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBnZXQgc3BlY2lmaWMgcmVzdGF1cmFudFxyXG4gIHN0YXRpYyBnZXRJRChpZCkge1xyXG4gICAgcmV0dXJuIGRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIsIFwicmVhZG9ubHlcIik7XHJcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIpO1xyXG4gICAgICAgIHJldHVybiBzdG9yZS5nZXQocGFyc2VJbnQoaWQpKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudE9iamVjdCA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRPYmplY3Q7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYEVSUk9SOiAke2V9YCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gZ2V0IHZhbHVlcyBmb3Igc3RvcmVcclxuICBzdGF0aWMgZ2V0QWxsKCkge1xyXG4gICAgZGJQcm9taXNlXHJcbiAgICAgIC50aGVuKGRiID0+IHtcclxuICAgICAgICByZXR1cm4gZGJcclxuICAgICAgICAgIC50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIpXHJcbiAgICAgICAgICAub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKVxyXG4gICAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiBjb25zb2xlLmxvZyhyZXN0YXVyYW50cykpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBjYWxsYmFjayB3aWxsIGdldCBpbnN0YW5jZSBvZiByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuYWRkUmVzdChjYWxsYmFjayk7XHJcbiAgICAvLyBpZiBubyByZXN0YXVyYW50cyBmZXRjaCBmcm9tIHNlcnZlclxyXG4gICAgaWYgKCFyZXN0YXVyYW50cykge1xyXG4gICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICAgIGlmICghcmVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKCkudGhlbihkYXRhID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaCBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgLy8gcmV0dXJucyBpbnN0YW5jZSBvZiBhIHJlc3RhdXJhbnQgb2JqZWN0IGZyb20gdGhlIGFycmF5XHJcbiAgICBsZXQgcmVzdGF1cmFudCA9IERCSGVscGVyLmdldElEKGlkKTtcclxuICAgIHJlc3RhdXJhbnQudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgLy8gaWYgd2UgaGF2ZSB2YWxpZCByZXNwb25zZSBwYXNzIHRvIGNhbGxiYWNrXHJcbiAgICAgIGlmIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIGZldGNoIGZyb20gbm90IHdvcmsgaWYgd2UgZG9udCBoYXZlIHJlc3BvbnNlXHJcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQoXHJcbiAgICAgICAgICAgICAgKG9iaiwgaW5kZXgpID0+IG9ialtcImlkXCJdID09PSBpbmRleCArIDFcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKFwiUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdFwiLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICBjYWxsYmFja1xyXG4gICkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gXCJhbGxcIikge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9IFwiYWxsXCIpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKFxyXG4gICAgICAgICAgKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGBpbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBhbHQgZGVzY3JpcHRpb24uXHJcbiAgICovXHJcbiAgc3RhdGljIGFsdEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAke3Jlc3RhdXJhbnQuYWx0fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG59XHJcbiIsImxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcFwiKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IGNhbGxiYWNrID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKFwiaWRcIik7XG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9IFwiTm8gcmVzdGF1cmFudCBpZCBpbiBVUkxcIjtcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LW5hbWVcIik7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtYWRkcmVzc1wiKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtaW1nXCIpO1xuICBpbWFnZS5jbGFzc05hbWUgPSBcInJlc3RhdXJhbnQtaW1nXCI7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWN1aXNpbmVcIik7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKFxuICBvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnNcbikgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1ob3Vyc1wiKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtY29udGFpbmVyXCIpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gXCJSZXZpZXdzXCI7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9IFwiTm8gcmV2aWV3cyB5ZXQhXCI7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXdzLWxpc3RcIik7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IHJldmlldyA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnJlYWRjcnVtYlwiKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcImN1cnJlbnQgcGFnZVwiKTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gXCJcIjtcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCBcIiBcIikpO1xufTtcbiJdfQ==
