class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDb(){return idb.open("restv1Db",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static cacheRest(){const t=DBHelper.openDb();if(t)return t.then(t=>{if(!t)return;return t.transaction("restaurant","readwrite").objectStore("restaurants").getAll()})}static fetchRestaurants(t){fetch(DBHelper.DATABASE_URL).then(e=>{e&&e.json().then(e=>{t(null,e)})}).catch(e=>{t(e,null),console.log(`Fetch Error: ${e}`)})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.find((t,e)=>t.id===e+1);t?e(null,t):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`img/${t.id}.jpg`}static altForRestaurant(t){return`${t.alt}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurant;var map;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const l=document.createElement("td");l.innerHTML=e[n],r.appendChild(l),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=e.date,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-label","current page"),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEQiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImRiUHJvbWlzZSIsIm9wZW5EYiIsInRoZW4iLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJjYWxsYmFjayIsImZldGNoIiwicmVzIiwianNvbiIsInJlc3RhdXJhbnRzIiwiY29uc29sZSIsImVyciIsImxvZyIsImlkIiwiZXJyb3IiLCJyZXN0YXVyYW50IiwiZmluZCIsImluZGV4IiwiY3Vpc2luZSIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN1bHRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsImZldGNoTmVpZ2hib3Job29kcyIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwiaW5kZXhPZiIsIm1hcmtlciIsImdvb2dsZSIsImFsdCIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJzZWxmIiwiTWFwIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInpvb20iLCJjZW50ZXIiLCJzY3JvbGx3aGVlbCIsImZpbGxCcmVhZGNydW1iIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJpbm5lckhUTUwiLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJjcmVhdGVFbGVtZW50Iiwia2V5IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJyb3ciLCJ0aW1lIiwicmV2aWV3cyIsImNvbnRhaW5lciIsIm5vUmV2aWV3cyIsInVsIiwiY3JlYXRlUmV2aWV3SFRNTCIsInJldmlldyIsImZvckVhY2giLCJsaSIsImRhdGUiLCJyYXRpbmciLCJjb21tZW50cyIsInNldEF0dHJpYnV0ZSIsImJyZWFkY3J1bWIiLCJyZWdleCIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJyZXBsYWNlIl0sIm1hcHBpbmdzIjoiQUFJQSxNQUFNQSxTQUtKQywwQkFFRSxNQUFRLG9DQUdWQyxnQkFDRSxPQUFPQyxJQUFJQyxLQUFLLFdBQVksRUFBR0MsSUFDN0JBLEVBQVVDLGtCQUFrQixjQUFlLENBQ3pDQyxRQUFTLFNBS2ZMLG1CQUNFLE1BQU1NLEVBQVlSLFNBQVNTLFNBQzNCLEdBQUlELEVBQ0YsT0FBT0EsRUFBVUUsS0FBS0MsSUFDcEIsSUFBS0EsRUFDSCxPQU1GLE9BSFdBLEVBQUdDLFlBQVksYUFBYyxhQUN2QkMsWUFBWSxlQUVoQkMsV0FPbkJaLHdCQUF3QmEsR0FDdEJDLE1BQU1oQixTQUFTQyxjQUVYUyxLQUFLTyxJQUNIQSxHQUdFQSxFQUFBQyxPQUFNQyxLQUFBQSxJQURSSixFQUFBLEtBRWlCSSxPQU1uQkMsTUFBQUEsSUFiSkwsRUFBQU0sRUFBQSxNQWVERCxRQUFBRSxvQkFBQUQsT0FPQ3JCLDJCQUFBdUIsRUFBMkJDLEdBRXZCVCxTQUFBQSxpQkFBQSxDQUFBUyxFQUFBTCxLQUNELEdBRkRLLEVBR0VULEVBQU1VLEVBQUFBLFVBR0ZBLENBQ0YsTUFBQUEsRUFBQU4sRUFBQU8s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LFlBQVVKLGlCQUFWUSxNQUFBSixFQUFVSixZQUFZTSxLQVF0QkMsaUJBQWEvQixDQUFBQSxJQUNiWCxNQUFLcUIsRUFBQUEsU0FBWXNCLGNBQWpCLE1BQ0dSLEVBQUFBLFNBQUhILGNBQUEsS0FEQWhDLEVBQUtxQixVQUFZc0IsRUFBTzNDLEtBR3hCNkMsRUFBQVYsWUFBYXhCLEdBRWJrQyxNQUFHVixFQUFBQSxTQUFISCxjQUFBLEtBREFjLEVBQUt6QixVQUFZc0IsRUFBT0csS0FHeEJELEVBQUFWLFlBQWV4QixHQUVma0MsTUFBR1YsRUFBWVksU0FBZmYsY0FBQSxLQURBZSxFQUFPMUIscUJBQXVCc0IsRUFBT0ksU0FHckNGLEVBQUFWLFlBQU1hLEdBRU5ILE1BQUdWLEVBQVlhLFNBQWZoQixjQUFBLEtBRUEsT0FIQWdCLEVBQVMzQixVQUFZc0IsRUFBT0ssU0FHNUJILEVBQUFWLFlBQUFhLEdBQU9ILElBUVA3QixlQUFXTCxFQUFBQSxFQUFTcUIsS0FBYzNELGNBQ2xDd0UsTUFBR3hCLEVBQVloRCxTQUFXMkIsZUFBMUIsY0FDR2lELEVBQUFBLFNBQWFqQixjQUFjLE1BQzlCa0IsRUFBQUEsVUFBV2YsRUFBWG5DLEtBTEY2QyxFQUFBSSxhQUFBLGFBQUEsZ0JBS0VDLEVBQVdmLFlBQVlVLEtBUXZCN0MsbUJBQU8sRUFBYUEsRUFBQUMsS0FDcEJBLElBQU1rRCxFQUFRN0MsT0FBSThDLFNBQWNwRCxNQUFoQ0EsRUFDRXRCLEVBQUFBLFFBQVV5RSxVQURaLFFBRUEsTUFDQXpFLEVBRGMsSUFBQTBFLGNBQUFwRCxzQkFDR3FELEtBQUFwRCxHQUNqQixPQUFBdkIsRUFQRkEsRUFBQSxHQU9TNEUsbUJBQW1CNUUsRUFBUSxHQUFHNkUsUUFBUSxNQUFPLE1BUHRELEdBT1NEIiwiZmlsZSI6InJlc3RhdXJhbnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBvcGVuRGIoKSB7XHJcbiAgICByZXR1cm4gaWRiLm9wZW4oXCJyZXN0djFEYlwiLCAxLCB1cGdyYWRlREIgPT4ge1xyXG4gICAgICB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiLCB7XHJcbiAgICAgICAga2V5UGF0aDogXCJpZFwiXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgY2FjaGVSZXN0KCkge1xyXG4gICAgY29uc3QgZGJQcm9taXNlID0gREJIZWxwZXIub3BlbkRiKCk7XHJcbiAgICBpZiAoZGJQcm9taXNlKSB7XHJcbiAgICAgIHJldHVybiBkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRcIiwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIpO1xyXG5cclxuICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTClcclxuICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBpZiAoIXJlcykge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuanNvbigpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gZGF0YTtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjYWxsYmFjayhlcnIsIG51bGwpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaCBFcnJvcjogJHtlcnJ9YCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQoXHJcbiAgICAgICAgICAob2JqLCBpbmRleCkgPT4gb2JqW1wiaWRcIl0gPT09IGluZGV4ICsgMVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjayhcIlJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3RcIiwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChcclxuICAgIGN1aXNpbmUsXHJcbiAgICBuZWlnaGJvcmhvb2QsXHJcbiAgICBjYWxsYmFja1xyXG4gICkge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gXCJhbGxcIikge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9IFwiYWxsXCIpIHtcclxuICAgICAgICAgIC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKFxyXG4gICAgICAgICAgKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKFxyXG4gICAgICAgICAgKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGBpbWcvJHtyZXN0YXVyYW50LmlkfS5qcGdgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBhbHQgZGVzY3JpcHRpb24uXHJcbiAgICovXHJcbiAgc3RhdGljIGFsdEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAke3Jlc3RhdXJhbnQuYWx0fWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG59XHJcbiIsImxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcFwiKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IGNhbGxiYWNrID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkge1xuICAgIC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKFwiaWRcIik7XG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9IFwiTm8gcmVzdGF1cmFudCBpZCBpbiBVUkxcIjtcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LW5hbWVcIik7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtYWRkcmVzc1wiKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtaW1nXCIpO1xuICBpbWFnZS5jbGFzc05hbWUgPSBcInJlc3RhdXJhbnQtaW1nXCI7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWN1aXNpbmVcIik7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgZmlsbFJldmlld3NIVE1MKCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKFxuICBvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnNcbikgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1ob3Vyc1wiKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtY29udGFpbmVyXCIpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gXCJSZXZpZXdzXCI7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9IFwiTm8gcmV2aWV3cyB5ZXQhXCI7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXdzLWxpc3RcIik7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IHJldmlldyA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYnJlYWRjcnVtYlwiKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcImN1cnJlbnQgcGFnZVwiKTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gXCJcIjtcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCBcIiBcIikpO1xufTtcbiJdfQ==
