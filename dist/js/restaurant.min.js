var dbPromise;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDb(){return idb.open("restaurant-rev",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static addRest(){dbPromise=DBHelper.openDb(),console.log(dbPromise),fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(t=>{console.log(dbPromise),dbPromise.then(e=>{let r=e.transaction("restaurants","readwrite").objectStore("restaurants");t.forEach(t=>{r.put(t)})}),callback(null,t)}).catch(t=>{dbPromise.then(t=>{return t.transaction("restaurants").objectStore("restaurants").getAll()})})}static getID(t){return dbPromise.then(e=>{return e.transaction("restaurants","readonly").objectStore("restaurants").get(parseInt(t))}).then(t=>t).catch(function(t){console.log(`ERROR: ${t}`)})}static getAll(){dbPromise.then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(t=>console.log(t))}static fetchRestaurants(t){DBHelper.addRest(t),restaurants||fetch(DBHelper.DATABASE_URL).then(e=>{e&&e.json().then(e=>{t(null,e)})}).catch(e=>{t(e,null),console.log(`Fetch Error: ${e}`)})}static fetchRestaurantById(t,e){DBHelper.getID(t).then(t=>{t?e(null,t):DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.find((t,e)=>t.id===e+1);t?e(null,t):e("Restaurant does not exist",null)}})}).catch(t=>{e(t,null)})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.cuisine_type==t);e(null,r)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((r,a)=>{if(r)e(r,null);else{const r=a.filter(e=>e.neighborhood==t);e(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,r){DBHelper.fetchRestaurants((a,n)=>{if(a)r(a,null);else{let a=n;"all"!=t&&(a=a.filter(e=>e.cuisine_type==t)),"all"!=e&&(a=a.filter(t=>t.neighborhood==e)),r(null,a)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].neighborhood),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,r)=>{if(e)t(e,null);else{const e=r.map((t,e)=>r[e].cuisine_type),a=e.filter((t,r)=>e.indexOf(t)==r);t(null,a)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`img/${t.id}.jpg`}static altForRestaurant(t){return`${t.alt}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurant;var map;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt=DBHelper.altForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const l=document.createElement("td");l.innerHTML=e[n],r.appendChild(l),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=e.date,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-label","current page"),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
let restaurants,neighborhoods,cuisines;var map,markers=[];document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines(),registerWorker()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,s=t.selectedIndex,n=e[r].value,o=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,o,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),r=document.createElement("img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.alt=DBHelper.altForRestaurant(e),t.append(r);const s=document.createElement("h1");s.innerHTML=e.name,t.append(s);const n=document.createElement("p");n.innerHTML=e.neighborhood,t.append(n);const o=document.createElement("p");o.innerHTML=e.address,t.append(o);const a=document.createElement("a");return a.innerHTML="View Details",a.href=DBHelper.urlForRestaurant(e),t.append(a),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),registerWorker=(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("Registration successful, scope is:",e.scope)}).catch(e=>{console.log("Service worker registration failed, error: ",e)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJkYlByb21pc2UiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlREIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJvcGVuRGIiLCJjb25zb2xlIiwibG9nIiwiZmV0Y2giLCJ0eCIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsInJlc3RhdXJhbnRzIiwiZm9yRWFjaCIsInJlc3RhdXJhbnQiLCJwdXQiLCJ0aGVuIiwiZGIiLCJjYXRjaCIsImdldEFsbCIsInJlc3RhdXJhbnRPYmplY3QiLCJnZXQiLCJwYXJzZUludCIsImlkIiwiZSIsImZldGNoUmVzdGF1cmFudHMiLCJjYWxsYmFjayIsImFkZFJlc3QiLCJyZXMiLCJqc29uIiwiZGF0YSIsImVyciIsImdldElEIiwiZXJyb3IiLCJmaW5kIiwib2JqIiwiaW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsInIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJ2IiwiaSIsImluZGV4T2YiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJhbHRGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwibWFwcyIsImFsdCIsImdvb2dsZSIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsIkFuaW1hdGlvbiIsIkRST1AiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZpbGxSZXN0YXVyYW50SFRNTCIsImlubmVySFRNTCIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImNyZWF0ZUVsZW1lbnQiLCJrZXkiLCJkYXkiLCJhcHBlbmRDaGlsZCIsInJvdyIsInRpbWUiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwidWwiLCJjcmVhdGVSZXZpZXdIVE1MIiwicmV2aWV3IiwibGkiLCJkYXRlIiwicmF0aW5nIiwiY29tbWVudHMiLCJzZXRBdHRyaWJ1dGUiLCJicmVhZGNydW1iIiwicmVnZXgiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwicmVwbGFjZSIsIm1hcmtlcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaEN1aXNpbmVzIiwicmVnaXN0ZXJXb3JrZXIiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJvcHRpb24iLCJ2YWx1ZSIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJsYXQiLCJsbmciLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJyZXNldFJlc3RhdXJhbnRzIiwibSIsInNldE1hcCIsImFkZE1hcmtlcnNUb01hcCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJsb2NhdGlvbiIsInB1c2giLCJhZGRMaXN0ZW5lciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInJlZ2lzdHJhdGlvbiIsInNjb3BlIl0sIm1hcHBpbmdzIjoiQUFHQSxJQUFJQSxVQUNKLE1BQU1DLFNBS0pDLDBCQUVFLE1BQVEsb0NBR1ZDLGdCQUNFLE9BQU9DLElBQUlDLEtBQUssaUJBQWtCLEVBQUdDLElBQ25DQSxFQUFVQyxrQkFBa0IsY0FBZSxDQUN6Q0MsUUFBUyxTQU1mTCxpQkFDRUgsVUFBWUMsU0FBU1EsU0FDckJDLFFBQVFDLElBQUlYLFdBQ1pZLE1BQU1YLFNBQVNDLGNBR1hRLEtBQUFBLEdBQVlWLEVBQUFBLFFBQ1pBLEtBQUFBLElBQ0VVLFFBQUlHLElBQVFDLFdBQ1pkLFVBQUllLEtBQVdDLElBQ2ZDLElBQ0VGLEVBREZFLEVBQVlDLFlBQVFDLGNBQWMsYUFDdEJBLFlBQVYsZUFERkYsRUFBQUMsUUFBQUMsSUFIRkosRUFBQUssSUFBQUQsT0FVQW5CLFNBQVVxQixLQUFLQyxLQUViQyxNQUFJUixJQUNKZixVQUFPZSxLQUFNUyxJQUdwQixPQU5LRixFQUFBUixZQUFBLGVBZEpFLFlBQUEsZUFvQkRRLGFBT0tyQixhQUFNWSxHQUNOLE9BQUFmLFVBRURxQixLQUFLSSxJQUlKZixPQUhPZSxFQUFBQSxZQUFQLGNBQUEsWUFFS1QsWUFBWSxlQUNKVSxJQUFBQyxTQUFiQyxNQUVMUCxLQUFBSSxHQUxZQSxHQVFiRixNQUFPQyxTQUFTSyxHQUNkN0IsUUFDR3FCLGNBQVdRLE9BU2hCMUIsZ0JBVkVILFVBQ0dxQixLQUFLQyxHQVlIUSxFQUNMaEIsWUFBQSxlQUNBYixZQUFpQjhCLGVBQ2pCUCxVQUVFWixLQUFNWCxHQUFTQyxRQUNabUIsSUFESEosSUFPUWMsd0JBQUFBLEdBRUg5QixTQUFBK0IsUUFBQUQsR0FHREEsYUFDQXJCLE1BQUFBLFNBQWFSLGNBYmpCbUIsS0FBQVksSUFlREEsR0FH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QixPQUFPOUQsR0FFVixNQUFNcEIsRUFBQUEsU0FBZThCLGNBQVNvQixNQUM5QmxELEVBQUFBLFVBQWF3QyxFQUFZckUsS0FDekIyRixFQUFHb0IsT0FBT2xGLEdBRVYsTUFBTXlDLEVBQVVYLFNBQVNvQixjQUF6QixLQUNBVCxFQUFRRCxVQUFZckUsRUFBV3NFLGFBQy9CcUIsRUFBR29CLE9BQU96QyxHQUVWLE1BQU0wRCxFQUFPckUsU0FBU29CLGNBQVQsS0FDYmlELEVBQUszRCxVQUFZckUsRUFBakJzRSxRQUNBMEQsRUFBQUEsT0FBQTFELEdBRkEsTUFBTTBELEVBQU9yRSxTQUFTb0IsY0FBYyxLQUtwQyxPQUFBaUQsRUFBQTNELFVBQUEsZUExQkYyRCxFQUFBQyxLQUFBbkosU0FBQXFFLGlCQUFBbkQsR0F3QkUyRixFQUFHb0IsT0FBT2lCLEdBRUhyQyxJQVVML0MsZ0JBQVk0RCxFQUFBQSxFQUFaL0MsS0FBOEJ5RSxlQUM1QjVFLEVBQU82RSxRQUFTRixJQUVsQnhFLE1BQUs2QyxFQUFROEIsU0FBYm5FLHVCQUFBakUsRUFBQXlELEtBQUF6QixLQU5GWSxPQUFBRixLQUFBOEQsTUFBQTZCLFlBQUFILEVBQUEsUUFBQSxLQURGNUUsT0FBQTZFLFNBQUFGLEtBQUFDLEVBQUFoRixNQVdBd0QsS0FBQUEsUUFBaUIwQixLQUFBRixPQU1WeEIsZUFDTXpGLE1BQ0wxQixrQkFBWStJLFdBQ2JBLFVBUEhDLGNBUURDLFNBQUEsVUFWSHRJLEtBQUF1SSxJQUtRbEosUUFBUUMsSUFBSSxxQ0FBc0NpSixFQUFhQyxTQUVoRXRJLE1BQU1hLElBQ0wxQixRQUFRQyxJQUFJLDhDQUErQ3lCIiwiZmlsZSI6InJlc3RhdXJhbnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxudmFyIGRiUHJvbWlzZTtcclxuY2xhc3MgREJIZWxwZXIge1xyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG9wZW5EYigpIHtcclxuICAgIHJldHVybiBpZGIub3BlbihcInJlc3RhdXJhbnQtcmV2XCIsIDEsIHVwZ3JhZGVEQiA9PiB7XHJcbiAgICAgIHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShcInJlc3RhdXJhbnRzXCIsIHtcclxuICAgICAgICBrZXlQYXRoOiBcImlkXCJcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGFkZCByZXN0YXVyYW50cyB0byBvcGVuZWQgSURCXHJcbiAgc3RhdGljIGFkZFJlc3QoKSB7XHJcbiAgICBkYlByb21pc2UgPSBEQkhlbHBlci5vcGVuRGIoKTtcclxuICAgIGNvbnNvbGUubG9nKGRiUHJvbWlzZSk7XHJcbiAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgIC50aGVuKHJlcyA9PiByZXMuanNvbigpKVxyXG4gICAgICAudGhlbihyZXN0YXVyYW50cyA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZGJQcm9taXNlKTtcclxuICAgICAgICBkYlByb21pc2UudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihcInJlc3RhdXJhbnRzXCIsIFwicmVhZHdyaXRlXCIpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKTtcclxuICAgICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgZGJQcm9taXNlLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJyZXN0YXVyYW50c1wiKTtcclxuICAgICAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwicmVzdGF1cmFudHNcIik7XHJcbiAgICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gZ2V0IHNwZWNpZmljIHJlc3RhdXJhbnRcclxuICBzdGF0aWMgZ2V0SUQoaWQpIHtcclxuICAgIHJldHVybiBkYlByb21pc2VcclxuICAgICAgLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJyZXN0YXVyYW50c1wiLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJyZXN0YXVyYW50c1wiKTtcclxuICAgICAgICByZXR1cm4gc3RvcmUuZ2V0KHBhcnNlSW50KGlkKSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnRPYmplY3QgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXN0YXVyYW50T2JqZWN0O1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBFUlJPUjogJHtlfWApO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGdldCB2YWx1ZXMgZm9yIHN0b3JlXHJcbiAgc3RhdGljIGdldEFsbCgpIHtcclxuICAgIGRiUHJvbWlzZVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGRiXHJcbiAgICAgICAgICAudHJhbnNhY3Rpb24oXCJyZXN0YXVyYW50c1wiKVxyXG4gICAgICAgICAgLm9iamVjdFN0b3JlKFwicmVzdGF1cmFudHNcIilcclxuICAgICAgICAgIC5nZXRBbGwoKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4gY29uc29sZS5sb2cocmVzdGF1cmFudHMpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG4gICAgLy8gY2FsbGJhY2sgd2lsbCBnZXQgaW5zdGFuY2Ugb2YgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmFkZFJlc3QoY2FsbGJhY2spO1xyXG4gICAgLy8gaWYgbm8gcmVzdGF1cmFudHMgZmV0Y2ggZnJvbSBzZXJ2ZXJcclxuICAgIGlmICghcmVzdGF1cmFudHMpIHtcclxuICAgICAgZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxyXG4gICAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICBpZiAoIXJlcykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXMuanNvbigpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgRmV0Y2ggRXJyb3I6ICR7ZXJyfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIC8vIHJldHVybnMgaW5zdGFuY2Ugb2YgYSByZXN0YXVyYW50IG9iamVjdCBmcm9tIHRoZSBhcnJheVxyXG4gICAgbGV0IHJlc3RhdXJhbnQgPSBEQkhlbHBlci5nZXRJRChpZCk7XHJcbiAgICByZXN0YXVyYW50XHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIC8vIGlmIHdlIGhhdmUgdmFsaWQgcmVzcG9uc2UgcGFzcyB0byBjYWxsYmFja1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gZmV0Y2ggZnJvbSBub3Qgd29yayBpZiB3ZSBkb250IGhhdmUgcmVzcG9uc2VcclxuICAgICAgICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQoXHJcbiAgICAgICAgICAgICAgICAob2JqLCBpbmRleCkgPT4gb2JqW1wiaWRcIl0gPT09IGluZGV4ICsgMVxyXG4gICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhcIlJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3RcIiwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKFxyXG4gICAgY3Vpc2luZSxcclxuICAgIG5laWdoYm9yaG9vZCxcclxuICAgIGNhbGxiYWNrXHJcbiAgKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSBcImFsbFwiKSB7XHJcbiAgICAgICAgICAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gXCJhbGxcIikge1xyXG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoXHJcbiAgICAgICAgICAodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXHJcbiAgICAgICAgKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGlcclxuICAgICAgICApO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXHJcbiAgICAgICAgICAodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYGltZy8ke3Jlc3RhdXJhbnQuaWR9LmpwZ2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGFsdCBkZXNjcmlwdGlvbi5cclxuICAgKi9cclxuICBzdGF0aWMgYWx0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gYCR7cmVzdGF1cmFudC5hbHR9YDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnQ7XG52YXIgbWFwO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFwXCIpLCB7XG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gY2FsbGJhY2sgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7XG4gICAgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoXCJpZFwiKTtcbiAgaWYgKCFpZCkge1xuICAgIC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gXCJObyByZXN0YXVyYW50IGlkIGluIFVSTFwiO1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtbmFtZVwiKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1hZGRyZXNzXCIpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1pbWdcIik7XG4gIGltYWdlLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudC1pbWdcIjtcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5hbHQgPSBEQkhlbHBlci5hbHRGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtY3Vpc2luZVwiKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAoXG4gIG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vyc1xuKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWhvdXJzXCIpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmV2aWV3c0hUTUwgPSAocmV2aWV3cyA9IHNlbGYucmVzdGF1cmFudC5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmV2aWV3cy1jb250YWluZXJcIik7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgyXCIpO1xuICB0aXRsZS5pbm5lckhUTUwgPSBcIlJldmlld3NcIjtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gXCJObyByZXZpZXdzIHlldCFcIjtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtbGlzdFwiKTtcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gcmV2aWV3ID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJicmVhZGNydW1iXCIpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBsaS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiY3VycmVudCBwYWdlXCIpO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiBcIlwiO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG59O1xuIiwibGV0IHJlc3RhdXJhbnRzLCBuZWlnaGJvcmhvb2RzLCBjdWlzaW5lcztcclxudmFyIG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGV2ZW50ID0+IHtcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbiAgcmVnaXN0ZXJXb3JrZXIoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5laWdoYm9yaG9vZHMtc2VsZWN0XCIpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN1aXNpbmVzLXNlbGVjdFwiKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYXBcIiksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdWlzaW5lcy1zZWxlY3RcIik7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmVpZ2hib3Job29kcy1zZWxlY3RcIik7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG5cclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoXHJcbiAgICBjdWlzaW5lLFxyXG4gICAgbmVpZ2hib3Job29kLFxyXG4gICAgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5yZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHMgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnRzLWxpc3RcIik7XHJcbiAgdWwuaW5uZXJIVE1MID0gXCJcIjtcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudHMtbGlzdFwiKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSByZXN0YXVyYW50ID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9IFwicmVzdGF1cmFudC1pbWdcIjtcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2UuYWx0ID0gREJIZWxwZXIuYWx0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBsaS5hcHBlbmQoaW1hZ2UpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSBcIlZpZXcgRGV0YWlsc1wiO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKG1vcmUpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufTtcclxuXHJcbnJlZ2lzdGVyV29ya2VyID0gKCkgPT4ge1xyXG4gIGlmIChcInNlcnZpY2VXb3JrZXJcIiBpbiBuYXZpZ2F0b3IpIHtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyXHJcbiAgICAgIC5yZWdpc3RlcihcIi9zdy5qc1wiKVxyXG4gICAgICAudGhlbihyZWdpc3RyYXRpb24gPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUmVnaXN0cmF0aW9uIHN1Y2Nlc3NmdWwsIHNjb3BlIGlzOlwiLCByZWdpc3RyYXRpb24uc2NvcGUpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiBmYWlsZWQsIGVycm9yOiBcIiwgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59O1xyXG4iXX0=
